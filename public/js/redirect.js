/* eslint-env browser */

const toTest = [
  '2014',
  '29digital',
  'addons',
  'ajaxload',
  'alphaworks',
  'andybudd',
  'apple',
  'apps',
  'askonomm',
  'b2gbuilds',
  'barcampbrighton',
  'bbc',
  'blog',
  'brandonaaron',
  'browser',
  'buses',
  'caturday-post',
  'charlessoft',
  'chocolatey',
  'chrome',
  'cloudflare',
  'codepen',
  'comox',
  'conorhaining',
  'cultcollectors',
  'danio',
  'dapper',
  'del',
  'dev',
  'developer',
  'developerfocus',
  'developers',
  'digg',
  'diggnation',
  'dl-client',
  'docs',
  'duckduckgo',
  'dustindiaz',
  'enterprisenation',
  'entropy',
  'eosrei',
  'euro',
  'expressjs',
  'extjs',
  'facebook',
  'feeds',
  'fireeagle',
  'fitbit',
  'flowtype',
  'folktrash',
  'font-family',
  'forbind',
  'futureofwebdesign',
  'game',
  'getahead',
  'gratipay',
  'handbrake',
  'hang',
  'haveamint',
  'headshots',
  'help',
  'hobbytronics',
  'http:',
  'httpd',
  'hybridconf',
  'icanhaz',
  'icnhz',
  'ihatemusic',
  'iwebinspector',
  'jackosborne',
  'jaoo',
  'jigsaw',
  'joehewitt',
  'jquery-api-browser',
  'jqueryfordesigners',
  'jsbin',
  'jsconf',
  'jsconsole',
  'jsdoctoolkit',
  'jsonbin',
  'jsperf',
  'jspm',
  'kamilogorek',
  'kelvinluck',
  'kiss100',
  'knowledge',
  'labs',
  'lachy',
  'lanyrd',
  'last',
  'leftlogic',
  'line-mode',
  'lit-thicket-2959',
  'livedocs',
  'livereload',
  'loader-simple',
  'loader-sw',
  'macromates',
  'marbles2',
  'marketplace',
  'media',
  'medium-poster',
  'microsoft',
  'mobilism',
  'moduscreate',
  'moeffju',
  'mydreamapp',
  'new-life',
  'nodejs',
  'noopkat',
  'oaa-accessibility',
  'oldweb',
  'onair',
  'p01',
  'parrot',
  'passportjs',
  'phobos',
  'phonegap',
  'phuu',
  'pipes',
  'plugins',
  'plus',
  'potionfactory',
  'queuesoft',
  'quick',
  'quickleft',
  'rachelandrew',
  'readlists',
  'reasonstobeappy',
  'rem',
  'rems',
  'remy',
  'remysharp',
  'revision3',
  'rikrikrik',
  'rmurphey',
  'robinlu',
  'samsontech',
  'scottandrew',
  'semver',
  'shauninman',
  'skillswap-brighton',
  'slicehost',
  'slideshare',
  'snapbird',
  'snapdrop',
  'snipplr',
  'snyk',
  'sourcedevcon',
  'stephendeken',
  'stevesouders',
  'stopbadware',
  'store',
  'storify',
  'stripe',
  'stubmatic',
  'taxdo',
  'techspansion',
  'telegraph',
  'tesco',
  'tescophoto',
  'the-pastry-box-project',
  'thebeebs',
  'thecounter',
  'thecssworkshop',
  'thenodefirm',
  'thinkvitamin',
  'thinkweb2',
  'thumbslap',
  'tinyurl',
  'tldr',
  'todged',
  'tostring',
  'touchdev',
  'trac',
  'trace',
  'tuaw',
  'twitpicapi',
  'twitpickr',
  'twitterdevelopernest',
  'twivatar',
  'uk',
  'ukplc',
  'validator',
  'varasoftware',
  'vdgraaf',
  'vim',
  'vimeo',
  'w3counter',
  'web',
  'web-graphics',
  'webeyedea',
  'webkit',
  'weblogs',
  'webmention',
  'wiki',
  'writing',
  'ws',
  'www2012',
  'yourpsp',
  'zappatic',
];

document.body.addEventListener(
  'click',
  (event) => {
    if (event.target.nodeName === 'A') {
      /** @type String */
      const href = event.target.href;

      if (!href.startsWith('http')) {
        // ignore it
        return;
      }

      const url = new URL(href);
      const hit = toTest.filter((_) => url.host.includes('/' + _ + '.')).length;

      if (!hit) {
        return;
      }

      let date = '';

      if (location.pathname.startsWith('/2')) {
        date = location.pathname.substr(1, 10).replace(/\//g, '-');
        event.target.href = `/redirect?url=${href}&date=${date}`;
      } else {
        event.target.href = `/redirect?url=${href}`;
      }
    }
  },
  true
);
